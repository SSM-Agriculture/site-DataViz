<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="  Premier producteur agricole de l’Union européenne, la France dispose aussi d’une puissante force de transformation avec ses industries agroalimentaires (IAA). En chiffre d’affaires ou en valeur ajoutée, seule l’Allemagne la dépasse, depuis 2015.    ">

<title>Signes de qualité ou d’origine – Catalogue des Viz proposé par le SSM Agriculture</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ca9a02525e315e07c29cfdfe59dc3672.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/intersection-observer-polyfill-1.0.0/intersection-observer.js"></script>
<script src="../../site_libs/quarto-contrib/scrollama-3.2.0/scrollama.min.js"></script>
<script src="../../site_libs/quarto-contrib/closeread-0.1.0/closeread.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta cr-debug-mode="false">
<meta cr-remove-header-space="false">


<link rel="stylesheet" href="_extensions/qmd-lab/closeread/closeread.css">
<link rel="stylesheet" href="../../masa-closeread.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Catalogue des Viz proposé par le SSM Agriculture</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SSM-Agriculture/site-DataViz"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Signes de qualité ou d’origine</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Exploitations agricoles</div>
  </div>
  </div>

<div>
  <div class="description">
    <p><br> Premier producteur agricole de l’Union européenne, la France dispose aussi d’une puissante force de transformation avec ses industries agroalimentaires (IAA). En chiffre d’affaires ou en valeur ajoutée, seule l’Allemagne la dépasse, depuis 2015. <br> <br></p>
  </div>
</div>


<div class="quarto-title-meta column-page">

    
  
    
  </div>
  


</header>


<p>Cinq signes de qualité ou d’origine (dénommés aussi « SIQO ») peuvent qualifier les produits d’une exploitation agricole. L’Europe réglemente la plupart de ces certifications. Seul le label rouge est spécifiquement français.</p>
<p style="display:flex; align-items: center; gap: 2%;">
<img src="./data-png/36.png"> C’est la part des exploitations engagées dans au moins un signe de qualité ou d’origine en 2020, en France métropolitaine.
</p>
<div class="align-right" style="background-color: #fddbfa; border-radius: 15px;">
<p>Retourner à l’accueil <a href="https://vizagreste.agriculture.gouv.fr/" style="max-height: 100px; width: auto;"><img src="./data-png/Bouton Home.png" class="img-fluid"></a></p>
<p>Partager la Viz (Mail) <a href="mailto:?subject=Regarde%20ce%20rapport&amp;body=Voici%20le%20lien%20:%20https://monrapport.fr"><img src="./data-png/Bouton Share.png" class="img-fluid"></a></p>
<p>Partager la Viz (X) <a href="https://twitter.com/intent/tweet?text=Regarde%20ce%20rapport%20!&amp;url=https://monrapport.fr"><img src="./data-png/Bouton Share.png" class="img-fluid"></a></p>
<p>Partager la Viz (Facebook) <a href="https://www.facebook.com/sharer/sharer.php?u=https://monrapport.fr"><img src="./data-png/Bouton Share.png" class="img-fluid"></a></p>
<p>Explorer les données territoriales <img src="./data-png/Bouton Data Dep.png" alt="Ouvrir menu 1" onclick="openMenu('menu-overlay-1')" style="max-height: 100px; cursor: pointer;"></p>
<p>Pendant la navigation, appuyer pour accéder aux autres actions <img src="./data-png/Bouton Menu.png" alt="Ouvrir menu 2" onclick="openMenu('menu-overlay-2')" style="max-height: 100px; cursor: pointer;"></p>
<!-- MENU 1 : Départements -->
<div id="menu-overlay-1" class="menu-overlay">
<div class="menu-close" onclick="closeMenu('menu-overlay-1')">
<p>✖</p>
</div>
<div class="menu-option" onclick="goTo('https://vizagreste.agriculture.gouv.fr/#/indicateur/01/2020')">
<p>📍 01 Ain</p>
</div>
<div class="menu-option" onclick="goTo('https://vizagreste.agriculture.gouv.fr/#/indicateur/02/2020')">
<p>📍 02 Aisne</p>
</div>
</div>
<!-- MENU 2 : Paramètres  -->
<div id="menu-overlay-2" class="menu-overlay">
<div class="menu-close" onclick="closeMenu('menu-overlay-2')">
<p>✖</p>
</div>
<div class="menu-option" onclick="goTo('https://vizagreste.agriculture.gouv.fr/')">
<p>📈 Accueil</p>
</div>
<div class="menu-option" onclick="goTo('mailto:?subject=Regarde%20ce%20rapport&amp;body=Voici%20le%20lien%20: https://monrapport.fr')">
<p>📉 Partager la Viz</p>
</div>
</div>
</div>
<p><br> <br></p>
<p>
  <img src="./data-png/AB.png">
  « Agriculture biologique » (AB)
  <span class="tooltip-container">
    <span class="tooltip-question">?</span>
    <span class="tooltip-content">
      Ce mode privilégie les procédés non polluants, exclut l’usage des OGM et limite le recours aux intrants. Il est reconnu par l’Europe dès 1991. Concernant d’abord les productions végétales, il s’élargit au monde animal en 1999.
    </span>
  </span>
  garantit un mode de production respectueux de l’environnement et un niveau élevé de bien-être animal.
  
  <br>
  <br>
  
  <img src="./data-png/AOP.png">
  « Appellation d’origine protégée » (AOP) 
  <span class="tooltip-container">
    <span class="tooltip-question">?</span>
    <span class="tooltip-content">
      L’appellation d’origine contrôlée (AOC) désigne des produits répondant aux critères de l’AOP et protège la dénomination sur le territoire français. Elle constitue une étape vers l’AOP (signe européen apparu en 1992), qui protège le nom du produit dans toute l’Union. La notion d’ « appellation d’origine » est apparue en France dès 1905, pour lutter contre la fraude viticole. Le champ a été étendu en 1990 à l’ensemble des produits agricoles et alimentaires.
    </span>
  </span>
  désigne un produit dont toutes les étapes de production sont réalisées selon un savoir-faire reconnu dans une même aire géographique.
  
  <br>
  <br>
  
  <img src="./data-png/IGP.png">
  « Indication géographique protégée » (IGP)
  <span class="tooltip-container">
    <span class="tooltip-question">?</span>
    <span class="tooltip-content">
      Signe européen qui protège le nom du produit dans toute l'Union. L'IGP concerne surtout les vins, mais aussi les fromages, la viande et les fruits. Le jambon de Bayonne, la fraise du Périgord, la tomme de Savoie sont des IGP.
    </span>
  </span>
  identifie un produit agricole, brut ou transformé, dont les caractéristiques sont liées au lieu géographique dans lequel se déroule au moins sa production ou sa transformation selon des conditions bien déterminées.
  
  <br>
  <br>
  
  <img src="./data-png/label-rouge.png">
  « Label rouge »
  <span class="tooltip-container">
    <span class="tooltip-question">?</span>
    <span class="tooltip-content">
      Apparu dans la loi en France en 1960, sous l’impulsion d’aviculteurs, il concerne en premier lieu les produits animaux : volailles, œufs, viandes (et poissons). Il s’est étendu aux fruits et légumes, avec en 1966 l’ail de Lautrec.
    </span>
  </span>
  désigne des produits qui, par leurs conditions de production ou de fabrication, ont un niveau de qualité supérieur par rapport aux produits standards.
  
  <br>
  <br>
  
  <img src="./data-png/STG.png">
  « Spécialité traditionnelle garantie » (STG) 
  <span class="tooltip-container">
    <span class="tooltip-question">?</span>
    <span class="tooltip-content">
      Signe européen créé en 1992, il concerne en France peu d’exploitations (1 300) et trois spécialités : le lait de foin, les moules de Bouchot et le Berthoud. Autre exemple à l’étranger, la « pizza napoletana » est une STG italienne, qui peut être produite n’importe où tant que le cahier des charges est respecté.
    </span>
  </span>
  reconnaît une composition, une pratique ou un savoir-faire qui sont traditionnels. Ce signe est réservé aux produits alimentaires.
</p>
<p>AOP et IGP relèvent d’une géographie, d’un terroir, leur cartographie évolue donc peu. Les trois autres signes (AB, label rouge et STG) ne sont pas liés à une localisation spécifique.</p>
<p><br> <br></p>
<p>En 2020, les signes de qualité ou d’origine (SIQO) concernent 140 000 exploitations, soit 36 % de l’ensemble en France métropolitaine, contre 27 % en 2010.</p>
<p>
  Cette part augmente nettement, et tous les signes
  <span class="tooltip-container">
    <span class="tooltip-question">?⁠</span>
    <span class="tooltip-content">
      Le graphique suivant ne présente pas les STG : les exploitations bénéficiant de ce signe n’étaient pas comptabilisées en 2010. Elles sont par ailleurs peu nombreuses (1 300 en 2020).
    </span>
  </span>
  progressent en dix ans.
</p>
<section id="part-des-exploitations-avec-siqo-pour-2010-et-2020" class="level1">
<h1>Part des exploitations avec SIQO pour 2010 et 2020</h1>
<div class="cr-section cr-column-screen overlay-left">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-part-exploitation-avec-siqo">
<div class="narrative">
<p>L’agriculture biologique connait l’évolution la plus importante : la part des exploitations “bio” est multipliée par trois en dis ans.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-part-exploitation-avec-siqo" class="img-fluid-custom sticky">
<section id="part-des-exploitations-avec-siqo-pour-2010-et-2020-1" class="level2">
<h2 class="anchored" data-anchor-id="part-des-exploitations-avec-siqo-pour-2010-et-2020-1">Part des exploitations avec SIQO pour 2010 et 2020</h2>
<p><img src="./data-svg/part-des-exploitations-avec-signe-de-qualité-ou-d-origine-pour-2010-et-2020.svg" class="img-fluid"></p>
<details>
<summary>
ℹ️ Télécharger les données
</summary>
<p><a href="./data-csv/part-des-exploitations-avec-signe-de-qualité-ou-d-origine-pour-2010-et-2020.csv" download="" style="display: block; margin-top: 0.5rem;"> 📥 Format CSV </a> <a href="./data-svg/part-des-exploitations-avec-signe-de-qualité-ou-d-origine-pour-2010-et-2020.svg" download="" style="display: block; margin-top: 0.5rem;"> 📥 Format SVG </a> <a href="./data-png/part-des-exploitations-avec-signe-de-qualité-ou-d-origine-pour-2010-et-2020.png" download="" style="display: block; margin-top: 0.5rem;"> 📥 Format PNG </a></p>
</details>
</section>
</div>
</div>
</div>
</div>
<p>Une même exploitation peut cumuler plusieurs SIQO, pour un même produit ou des produits différents.</p>
<div class="cr-section cr-column-screen overlay-left">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-cumul-des-siqo">
<div class="narrative">
<p>Une fois sur deux, une exploitation engagée dans une IGP l’est aussi en AOP</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cumul-des-siqo1">
<div class="narrative">
<p>Plus généralement, quand une exploitation détient une IGP, deux fois sur trois, elle bénéficie d’un ou plusieurs autres SIQO. C’est aussi une caractéristique des exploitation poduisant une STG.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cumul-des-siqo2">
<div class="narrative">
<p>En revanche, les signes Agriculture Biologique et Label Rouge sont plus souvent présents seuls.</p>
</div>
</div>
<div class="trigger">
<div class="narrative">
<p>
  En revanche, les signes Agriculture Biologique et Label Rouge
  <span class="tooltip-container">
    <span class="tooltip-question">?⁠</span>
    <span class="tooltip-content">
      Un produit lable rouge ne peut bénéficier simultanément d'une AOP.
    </span>
  </span>
  sont plus souvent présents seuls.
</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-cumul-des-siqo" class="img-fluid-custom sticky">
<section id="parmi-les-exploitations-avec-siqo-part-de-celles-avec-au-moins-un-autre-signe" class="level2">
<h2 class="anchored" data-anchor-id="parmi-les-exploitations-avec-siqo-part-de-celles-avec-au-moins-un-autre-signe">Parmi les exploitations avec SIQO, part de celles avec au moins un autre signe</h2>
<p><img src="./data-svg/cumul-des-siqo.svg" class="img-fluid"></p>
</section>
</div>
<div id="cr-cumul-des-siqo1" class="img-fluid-custom sticky">
<section id="parmi-les-exploitations-avec-siqo-part-de-celles-avec-au-moins-un-autre-signe-1" class="level2">
<h2 class="anchored" data-anchor-id="parmi-les-exploitations-avec-siqo-part-de-celles-avec-au-moins-un-autre-signe-1">Parmi les exploitations avec SIQO, part de celles avec au moins un autre signe</h2>
<p><img src="./data-svg/cumul-des-siqo1.svg" class="img-fluid"></p>
</section>
</div>
<div id="cr-cumul-des-siqo2" class="img-fluid-custom sticky">
<section id="parmi-les-exploitations-avec-siqo-part-de-celles-avec-au-moins-un-autre-signe-2" class="level2">
<h2 class="anchored" data-anchor-id="parmi-les-exploitations-avec-siqo-part-de-celles-avec-au-moins-un-autre-signe-2">Parmi les exploitations avec SIQO, part de celles avec au moins un autre signe</h2>
<p><img src="./data-svg/cumul-des-siqo2.svg" class="img-fluid"></p>
</section>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/SSM-agriculture\.github\.io\/site-DataViz\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script src="../../masa-closeread.js"></script>




</body></html>